const SKIN={size:{width:256,height:128},elements:{body:[0,0,96,96],body_shadow:[96,0,96,96],hand:[192,0,32,32],hand_shadow:[224,0,32,32],foot:[192,32,64,32],foot_shadow:[192,64,64,32],credits:[0,96,64,32],default_eye:[64,96,32,32],angry_eye:[96,96,32,32],blink_eye:[128,96,32,32],happy_eye:[160,96,32,32],cross_eye:[192,96,32,32],surprised_eye:[224,96,32,32]}},genRandomID=(t=16)=>{charSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let e="";for(let i=0;i<t;i++){let t=Math.floor(Math.random()*charSet.length);e+=charSet.substring(t,t+1)}return e},setContainer=(t,e)=>{if(!(e instanceof HTMLElement))throw Error("Invalid element: container is not of type HTMLElement");t.container=e,t.container.id=t.randomID,t.container.innerHTML="\n\t\t\t<div class='line'>\n\t\t\t\t<div class='marker'></div>\n\t\t\t</div>\n\n\t\t\t<div class='body_shadow' body-part></div>\n\n\t\t\t<div class='back_foot_shadow' body-part></div>\n\t\t\t<div class='back_foot' body-part></div>\n\n\t\t\t<div class='body' body-part></div>\n\n\t\t\t<div class='eyes'>\n\t\t\t\t<div class='lEye' body-part></div>\n\t\t\t\t<div class='rEye' body-part></div>\n\t\t\t</div>\n\n\t\t\t<div class='front_foot_shadow' body-part></div>\n\t\t\t<div class='front_foot' body-part></div>",(async()=>{let e=document.createElement("style");null!==t.container.getAttribute("data-bodycolor")&&null!==t.container.getAttribute("data-feetcolor")?await t.getTeeImage(t.container.getAttribute("data-bodycolor"),t.container.getAttribute("data-feetcolor"),t.container.getAttribute("data-coloringmode")):await t.getTeeImage(),e.innerHTML=`\n\t\t\t\t#${t.randomID}.tee div[body-part] {\n\t\t\t\t\tbackground-image: url(${t.imageResult});\n\t\t\t\t\tbackground-size: 256em 128em;\n\t\t\t\t}`;let i=document.querySelector(`#${t.randomID}.tee style`);i&&i.remove(),t.container.appendChild(e)})(),t.lookAt(t.eyesAngle)},teeArray=[],teeIDsArray=[];class Tee{constructor(t,e){teeArray.push(this),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.elements=new Object,this.image=new Image,this.image.crossOrigin="",this.imageLink=t,this.teeEyesVariables=!1,this.eyesAngle=0;let i=()=>{let t=genRandomID();teeIDsArray.includes(t)?i():this.randomID=t};i(),teeIDsArray.push(this.randomID),e&&setContainer(this,e)}async loadImage(t){this.image.src=t,await this.image.decode(),this.canvas.width=this.image.width,this.canvas.height=this.image.height,this.canvas.style.width="256px",this.canvas.style.height="128px",this.ctx.drawImage(this.image,0,0,this.canvas.width,this.canvas.height)}isRatioLegal=()=>{const t=SKIN.size.width/SKIN.size.height;return this.image.width/this.image.height===t};getMultiplier=()=>this.image.width/SKIN.size.width;setColor(t,e){let i,s,n,a,o,r=this.currentImgData.data;for(o=0;o<r.length;o+=4){i=r[o],s=r[o+1],n=r[o+2],a=r[o+3];let h=new Color(i,s,n,a);COLOR_MODE[e](h,t),r[o]=h.r,r[o+1]=h.g,r[o+2]=h.b,r[o+3]=h.a}this.someImgData=r,this.setCanvas()}reorderBody(){let t,e=Array(256).fill(0),i=0,s=this.currentImgData.data;const n=192,a=255-i;for(t=0;t<s.length;t+=4)s[t+3]>128&&e[s[t]]++;for(let t=1;t<256;t++)e[i]<e[t]&&(i=t);for(t=0;t<s.length;t+=4){let e=s[t];e<=i&&0==i||(e=e<=i?Math.trunc(e/i*n):0==a?n:Math.trunc((e-i)/a*63+n),s[t]=e,s[t+1]=e,s[t+2]=e)}this.someImgData=s,this.setCanvas()}setCanvas(){this.currentCtx.putImageData(new ImageData(this.someImgData,this.d[2],this.d[3]),0,0)}isRatioLegal(){const t=SKIN.size.width/SKIN.size.height;return this.image.width/this.image.height===t}getMultiplier(){return this.image.width/SKIN.size.width}getColorArg(t,e){if(0==Object.keys(COLOR_FORMAT).includes(e))throw Error(`Invalid color format: ${e}\nValid formats: rgb, hsl, code`);return t=COLOR_FORMAT[e](t)}colorLimitForSkin(t,e=52.5){return t[2]<e&&(t[2]=e),t}colorConvert(t,e){return t=this.getColorArg(t,e),"rgb"==e&&(t=RGBToHSL(t[0],t[1],t[2])),t=this.colorLimitForSkin(t),t=HSLToRGB(t[0],t[1],t[2]),new Color(...t)}setColor2(t,e){t=this.colorConvert(t,e),this.setColor(t,"grayscale"),this.isBody&&this.reorderBody(),this.setColor(t,"default")}async getTeeImage(t="none",e="none",i="code"){await this.loadImage(this.imageLink),t=t.toString(),e=e.toString();let s=Object.keys(SKIN.elements);if(!this.isRatioLegal())throw Error("Image has wrong ratio.");for(let n in s){let a=s[n];this.elements[a]=document.createElement("canvas");let o=this.elements[a],r=this.getMultiplier();if(this.d=SKIN.elements[a].map((t=>t*r)),o.width=this.d[2],o.height=this.d[3],this.currentCtx=o.getContext("2d",{willReadFrequently:!0}),this.currentCtx.putImageData(this.ctx.getImageData(this.d[0],this.d[1],this.d[2],this.d[3]),0,0),"body"===s[n]?this.isBody=!0:this.isBody=!1,this.currentImgData=this.currentCtx.getImageData(0,0,this.d[2],this.d[3]),"none"!==t&&"none"!==e&&(a.includes("foot")?this.setColor2(e,i):a.includes("credits")||this.setColor2(t,i)),Object.keys(SKIN.elements)[s.length-1]===a){this.ctx.clearRect(0,0,this.ctx.width,this.ctx.height);for(let s=0;s<Object.keys(SKIN.elements).length;s++){let n=SKIN.elements[Object.keys(this.elements)[s]].map((t=>t*r));if(this.ctx.drawImage(this.elements[Object.keys(this.elements)[s]],n[0],n[1]),s===Object.keys(SKIN.elements).length-1)return this.imageResult=this.canvas.toDataURL(),this.bodyColor=t,this.feetColor=e,this.coloringMode=i,this.imageResult}}}}bindContainer(t){setContainer(this,t)}unbindContainer(){this.container.removeAttribute("id"),this.container=void 0}teeEyesTranslateFunction(){this.markerCoord={x:this.marker.getBoundingClientRect().x,y:this.marker.getBoundingClientRect().y},this.scale=this.container.getBoundingClientRect().width/this.container.offsetWidth,this.teeEyes.style.transform=`translate(${(this.markerCoord.x-this.container.getBoundingClientRect().x)/this.scale}px, ${(this.markerCoord.y-this.container.getBoundingClientRect().y)/this.scale}px)`}setTeeEyesVariables(){this.teeEyesVariables=!0,this.line=document.querySelector(`#${this.randomID}.tee .line`),this.marker=document.querySelector(`#${this.randomID}.tee .marker`),this.teeEyes=document.querySelector(`#${this.randomID}.tee .eyes`)}lookAtCursor(){this.setTeeEyesVariables();let t=this.line.getBoundingClientRect().x.toFixed(),e=this.line.getBoundingClientRect().y.toFixed();this.moveTeeEyesFunction=i=>{this.eyesAngle=180*Math.atan2(i.clientY-e,i.clientX-t)/Math.PI,this.line.style.transform=`translate(-1em, .5em) rotate(${this.eyesAngle}deg)`,this.teeEyesTranslateFunction()},this.eyeMoveEvent=document.addEventListener("mousemove",this.moveTeeEyesFunction)}dontLookAtCursor(){document.removeEventListener("mousemove",this.moveTeeEyesFunction)}lookAt(t=0){this.eyesAngle=t,this.setTeeEyesVariables(),this.line.style.transform=`translate(-1em, .5em) rotate(${t}deg)`,this.teeEyesTranslateFunction()}}document.querySelectorAll(".tee[data-skinimage]").forEach((t=>{new Tee(t.getAttribute("data-skinimage"),t)}));
//# sourceMappingURL=TeeAssembler.min.js.map